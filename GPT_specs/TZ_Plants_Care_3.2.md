# –¢–ó‚Äë3.2: –î–æ—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞—Å—Ç–µ–Ω–∏—è (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º)

> –¶–µ–ª—å: –¥–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –≤—Ä–µ–¥–∏—Ç–µ–ª–µ–π, –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤ –≤ –∫–∞—Ä—Ç–æ—á–∫—É —Ä–∞—Å—Ç–µ–Ω–∏—è.  
> –≠—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∏–∑ TZ_Plants_Care_3.1.md.

---

## 1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö

### 1.1. –°–≤—è–∑–∏ ¬´—Ä–∞—Å—Ç–µ–Ω–∏–µ ‚Üî –≤—Ä–µ–¥–∏—Ç–µ–ª—å/–∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ¬ª
```sql
CREATE TABLE plant_pest (
  plant_id INT REFERENCES plants(id) ON DELETE CASCADE,
  pest_id INT REFERENCES pests(id) ON DELETE CASCADE,
  PRIMARY KEY (plant_id, pest_id)
);

CREATE TABLE plant_disease (
  plant_id INT REFERENCES plants(id) ON DELETE CASCADE,
  disease_id INT REFERENCES diseases(id) ON DELETE CASCADE,
  PRIMARY KEY (plant_id, disease_id)
);
```

### 1.2. –ì–∞–ª–µ—Ä–µ—è —Å–∏–º–ø—Ç–æ–º–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```sql
CREATE TABLE disease_symptom_images (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  disease_id INT REFERENCES diseases(id) ON DELETE CASCADE,
  image_url TEXT NOT NULL,
  preview_url TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);

CREATE TABLE pest_symptom_images (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  pest_id INT REFERENCES pests(id) ON DELETE CASCADE,
  image_url TEXT NOT NULL,
  preview_url TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);
```

---

## 2. UI –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ä–∞—Å—Ç–µ–Ω–∏—è

### 2.1. –ù–æ–≤—ã–π —Ç–∞–± ¬´–ü—Ä–æ–±–ª–µ–º—ã¬ª
–í–Ω–∏–∑—É –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–± **¬´–ü—Ä–æ–±–ª–µ–º—ã¬ª** —Å —Ç—Ä–µ–º—è —Å–µ–∫—Ü–∏—è–º–∏:

- **–í—Ä–µ–¥–∏—Ç–µ–ª–∏** ‚Äî —Å–ø–∏—Å–æ–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –≤—Ä–µ–¥–∏—Ç–µ–ª–µ–π (–º–∏–Ω–∏‚Äë–∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ —Å—Å—ã–ª–∫–∞–º–∏).
- **–ó–∞–±–æ–ª–µ–≤–∞–Ω–∏—è** ‚Äî —Å–ø–∏—Å–æ–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π.
- **–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞** ‚Äî —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –≤—Ä–µ–¥–∏—Ç–µ–ª—è–º–∏/–∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è–º–∏ (—Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ 3.3 —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–µ–π).

### 2.2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π
- –ö–Ω–æ–ø–∫–∞ **¬´–î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–¥–∏—Ç–µ–ª—è¬ª** ‚Üí –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–∏—Å–∫–æ–º –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É `/pests` (multi‚Äëselect).
- –ö–Ω–æ–ø–∫–∞ **¬´–î–æ–±–∞–≤–∏—Ç—å –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ¬ª** ‚Üí –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ.
- –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ API –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞.

### 2.3. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –ú–∏–Ω–∏‚Äë–∫–∞—Ä—Ç–æ—á–∫–∏ (üêõ/üß´/üíä) –≤ —Å–µ—Ç–∫–µ: –∏–∫–æ–Ω–∫–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ, danger/type –±–µ–π–¥–∂.
- Tooltip –ø—Ä–∏ —Ö–æ–≤–µ—Ä–µ —Å –∫—Ä–∞—Ç–∫–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ–º/—Å–∏–º–ø—Ç–æ–º–∞–º–∏.
- –ö–ª–∏–∫ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—É—â–Ω–æ—Å—Ç–∏.

---

## 3. API

- `GET /api/plants/:id/problems` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
  ```json
  {
    "pests": [ { "id":1,"slug":"...", "name":"...", "danger_level":"..." } ],
    "diseases": [ { "id":2,"slug":"...", "name":"...", "disease_type":"..." } ],
    "medicines": []  // –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –¢–ó‚Äë3.3
  }
  ```
- `POST /api/plants/:id/pests` ‚Äî body: `{ "ids": [1,2,3] }`
- `POST /api/plants/:id/diseases` ‚Äî body: `{ "ids": [4,5] }`
- `DELETE /api/plants/:id/pests/:pestId`
- `DELETE /api/plants/:id/diseases/:diseaseId`

–ü—Ä–∞–≤–∞: —Ç–æ–ª—å–∫–æ `plants_admin`.

---

## 4. –°–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

- –ï—Å–ª–∏ —É —Ä–∞—Å—Ç–µ–Ω–∏—è –Ω–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º ‚Äî —Ç–µ–∫—Å—Ç: ¬´–î–ª—è —ç—Ç–æ–≥–æ —Ä–∞—Å—Ç–µ–Ω–∏—è –ø–æ–∫–∞ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤—Ä–µ–¥–∏—Ç–µ–ª–∏ –∏–ª–∏ –±–æ–ª–µ–∑–Ω–∏¬ª.
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ ‚Äî toast‚Äë—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
- –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ ‚Äî skeleton –∏ —Å–ø–∏–Ω–Ω–µ—Ä—ã.

---

## 5. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

- –î–æ–±–∞–≤–∏—Ç—å 3 —Ä–∞—Å—Ç–µ–Ω–∏—è, –∫–∞–∂–¥–æ–º—É —Å–≤—è–∑–∞—Ç—å 2 –≤—Ä–µ–¥–∏—Ç–µ–ª—è –∏ 1 –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ –∏–∑ –¢–ó‚Äë3.1.

---

## 6. –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–∞–±–æ—Ç

1. –ù–∞ –∫–∞—Ä—Ç–æ—á–∫–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –ø–æ—è–≤–∏–ª—Å—è —Ç–∞–± ¬´–ü—Ä–æ–±–ª–µ–º—ã¬ª —Å —Å–µ–∫—Ü–∏—è–º–∏.
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç; –ø—Ä–∞–≤–∞ —Å–æ–±–ª—é–¥–µ–Ω—ã.
3. –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è —Å API.
