# Домашняя страница: Kanban-доска задач

## Контекст

Главная страница заменена на канбан-доску «в духе Trello». Данные берутся из новых таблиц `user_todo_lists` и обновлённой `user_todos`. Каждый пользователь работает со своими колонками и карточками.

## Основные изменения

- **Колонки (todo-листы)**
  - Новая таблица `user_todo_lists` (id, user_id, title, position, timestamps).
  - CRUD-роут `/api/todo-lists` для создания, переименования, сортировки и удаления колонок.
  - При первом заходе автоматически создаётся колонка «ToDo». При удалении колонок задачи переезжают в ближайшую оставшуюся.

- **Карточки задач**
  - Таблица `user_todos` расширена полями `list_id` (внешний ключ) и `due_at`. Поле `parent_id` удалено — дерева больше нет.
  - API `/api/todos` теперь возвращает `{ lists, tasks }`. POST/PATCH учитывают `listId`, `position`, `dueAt`.
  - Позиции пересчитываются на сервере (normalize) после любых перемещений.

- **Доска на фронтенде**
  - Новый компонент `TaskBoard` (src/components/TaskBoard.jsx) управляет колонками, карточками и drag’n’drop.
  - HTML5 DnD между колонками и внутри колонок с подсвеченными зонами. Оптимистичный UI + синхронизация порядка.
  - Поддержка состояний: скрывать выполненные задачи через 5 секунд, глобальная кнопка «Показать выполненные» возвращает их.
  - Карточки отображают дату создания и позволяют редактировать дедлайн (`datetime-local`).
  - Интерфейсы «Добавить колонку», «Переименовать», «Удалить» + формы добавления задач.

- **Кнопка «Debug DnD»**
  - Роут `/debug-dnd` подключён как лабораторный стенд для проверки HTML5 DnD (две колонки с тестовыми карточками).

## Данные и миграции

- `backend/index.js` создаёт/обновляет таблицы и индексы.
- Старые записи `user_todos` при первом GET получают list_id первой колонки.
- Существующий фронт без /debug-dnd не сломается: новые ответы совместимы с TaskBoard, а legacy дерево удалено.

## API кратко

- `GET /api/todos` > `{ lists, tasks }`.
- `POST /api/todos` body `{ text, listId?, position?, dueAt? }`.
- `PATCH /api/todos/:id` > обновление текста, статуса, списка, позиции, дедлайна.
- `DELETE /api/todos/:id` > удаление карточки.
- `/api/todo-lists` — стандартные REST-глаголы для колонок, позиция нормализуется автоматически.

## UX

- Перетягивание мышью/клавиатурой не блокирует клики по кнопкам (используется `data-dnd-ignore`).
- Выполненные задачи скрываются через 5 секунд (таймеры очищаются при откате).
- Модальные окна для редактирования текста/дедлайна используют общую компоненту `Modal`.
- Отдельный блок с быстрыми действиями (Deploy) сохранён и не зависит от новой доски.

## Проверка

- `npm run build`
- Ручной сценарий: создать 2–3 колонки, накидать задач, перетащить между колонками, отметить «выполнено», проверить скрытие и кнопку «Показать выполненные», задать/очистить дедлайн, удалить колонку — задачи переехали в соседнюю.

