# Personal Portal — состояние проекта

## Обзор фронтенда

- **Главная (`/`)** — приветственный экран с быстрыми ссылками на ключевые разделы и локальным списком задач в `localStorage`.
  - Быстрые ссылки ведут к «Аналитике», «Нейронкам», «Документации» и «VPN».
  - Список задач поддерживает добавление, отметку выполнения и удаление, данные сохраняются в `localStorage`.
- **Аналитика (`/analytics`)** — каталог из четырёх статей, каждая открывается в модальном окне для полного текста:
  1. «API Gateway (KrakenD)» — про конфигурацию шлюза.
  2. «GraphQL» — о декларативных запросах и примере запроса.
  3. «OData» — стандарт унифицированных параметров выборки.
  4. «Postman — мини-инструкция» — тестирование API и примеры скриптов.
  - Раздел включает элементы управления (поиск, фильтр по темам) и теги навыков.
- **Нейросервисы (`/ai`)** — карточки инструментов (ChatGPT, Midjourney, Perplexity, памятка по промтам) с модальными подробностями и статусами.
- **Документация (`/docs`)** — три группы ссылок: продуктовые гайды, технические справочники и командные процессы.
- **Посты (`/posts`)** — быстрые заметки, хранящиеся в `localStorage`, с датой создания и сортировкой по убыванию.
- **VPN (`/vpn`)** — хаб, ведущий к заготовкам для Outline и VLESS.
  - Подстраницы описывают будущий функционал по управлению ключами, пока отображают заглушки и кнопки «Добавить ключ».
- **Настройки (`/settings`)** — форма профиля (имя, email, телефон) и переключатель светлой/тёмной темы.
  - Профиль сохраняется через API `/api/user/profile`, данные подгружаются при открытии страницы.
- **Админ-панель (`/admin`)** — доступна только роли `ALL`, включает дашборд с карточками перехода и системными метриками (CPU, диск, трафик, аптайм).
  - Подстраницы: управление пользователями, контентом (статьи/посты/ссылки) и журналом событий.

## Бэкенд и API

- Node.js + Express, PostgreSQL через `pg`, конфигурация в `backend/index.js`.
- Автоинициализация таблиц: `users`, `user_profiles`, `content_items`, `admin_logs`.
- Системный эндпоинт `/api/system-stats` возвращает загрузку CPU, памяти и uptime.

### Аутентификация и профиль пользователя

1. **Регистрация** (`POST /api/auth/register`): проверка уникальности имени пользователя, хэширование пароля `bcrypt`, сохранение роли `NON_ADMIN` и флага `vpn_can_create=false` по умолчанию.
2. **Логин** (`POST /api/auth/login`): проверка блокировки, сравнение хэшированного пароля, выдача JWT (`sub`, `username`), ответ содержит роль и право создания VPN.
3. **Сохранение сессии на фронте**: токен пишется в `localStorage`, пользователь хранится в контексте `AuthContext`. При монтировании происходит запрос `GET /api/auth/me` для валидации токена.
4. **Сброс пароля** (`POST /api/auth/reset-password`): поиск пользователя, обновление хэша.
5. **Профиль пользователя** (`GET/PUT /api/user/profile`): доступен только авторизованным; хранит имя, email и телефон в таблице `user_profiles`.

### Контроль доступа и роли

- В JWT-среде определены роли: `ALL`, `NON_ADMIN`, `ANALYTICS`, `NEURAL`, `VPN`.
- Middleware `authRequired` проверяет наличие и валидность токена; `requireRole(["ALL"])` ограничивает доступ к административным маршрутам.
- На фронтенде маршруты проверяют роль пользователя:
  - `ALL` — полный доступ, включая админ-панель.
  - `NON_ADMIN` — все основные разделы, без административных.
  - `ANALYTICS` — только «Аналитика» и общие страницы.
  - `NEURAL` — доступ к «Нейросервисам» и общему контенту.
  - `VPN` — доступ к разделам VPN.
- Админ-подразделы:
  - **Пользователи** — таблица с полями профиля, изменением роли, флагом `vpn_can_create` и блокировкой.
  - **Контент** — CRUD для статей/постов/ссылок портала.
  - **Журнал** — просмотр и добавление записей в `admin_logs`.

## Локальное состояние и UX-паттерны

- Модальные окна для чтения статей (компонент `ArticleModal`).
- Уведомления `react-hot-toast` для авторизации, сохранения профиля и админ-действий.
- Темизация на основе кастомного хука `useTheme`, состояние сохраняется в `localStorage`.
- Mobile-friendly сайдбар с жестами свайпа, контролируемый через глобальный `window.__toggleSidebar`.

## Идеи для следующих шагов

- Подключить реальные данные в разделах VPN и аналитики (например, подгрузка метрик).
- Реализовать синхронизацию постов/задач через бэкенд.
- Добавить историю уведомлений/новостей с бэкенда.

