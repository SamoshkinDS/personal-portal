name: Интеграция n8n
description: Страница /ai/n8n с витриной автоматизаций и запусков, проксируемых через backend.

## Структура страницы
- `src/pages/N8NIntegration.jsx` отображает три блока: описание платформы, список workflows и таблицу последних запусков.
- Верхняя карточка содержит описание сервиса, список ссылок и кнопку `btn btn-primary` для перехода в web-интерфейс n8n.
- Блок "Мои автоматизации" показывает аккордеоны по каждому workflow с метаданными, состоянием активности, количеством узлов и версией. При раскрытии доступен список узлов и JSON-фрагмент параметров, а также ссылка "Открыть в n8n".
- Раздел "Последние запуски" выводит таблицу executions с цветовой подсветкой статуса, бейджем длительности и иконками типа запуска (🖐/⚡).

## API и источники данных
- Обоим разделам данных служат новые backend-эндпоинты: `GET /api/n8n/workflows` и `GET /api/n8n/executions`.
- Фронтенд использует `apiAuthFetch` и передаёт Bearer-токен портала; дополнительные ключи пользователю не раскрываются.
- Параметр `limit=20` используется для получения последних запусков, поддерживаются также `status` и другие query-параметры n8n (прокидываются без изменений).
- Для старых инстансов n8n поддерживается fallback на `/rest/*`-эндпоинты; при необходимости путь можно переопределить через `N8N_WORKFLOWS_PATH` и `N8N_EXECUTIONS_PATH`.

## Хранение токена и конфигурация
- Токен n8n хранится только на backend в переменной окружения `N8N_API_KEY`. Клиент его не видит.
- Базовый URL API задаётся через `N8N_API_BASE_URL` (например, `https://n8n.samoshechkin.ru/api/v1`). Для формирования ссылок на UI можно задать `N8N_APP_BASE_URL`; если не задан, он вычисляется автоматически обрезкой `/api/v1`.
- Пользовательские пути к спискам можно задать через `N8N_WORKFLOWS_PATH` и `N8N_EXECUTIONS_PATH` (по умолчанию `/workflows` и `/executions`), кавычки и пробелы вокруг значений очищаются.
- При отсутствии конфигурации эндпоинты возвращают `503` и выводят предупреждение в логи (`[n8n] ...`).

## Расширение функциональности
- Дополнительные поля workflows/executions легко прокинуть: обновите сериализацию в `backend/routes/n8n.js` и используйте их в компоненте.
- Для новых секций на странице подключайте данные через те же методы: заведите новое состояние, вызывайте `apiAuthFetch` и отображайте блоки внутри `PageShell`.
- Если требуется кэширование или фильтрация на сервере, добавьте соответствующую логику в роутере до возврата JSON.
- Навигация хранится в `src/components/Sidebar.jsx`: чтобы добавить новые подразделы AI, расширяйте массив `NAV`.

## Связанные файлы
- Backend: `backend/routes/n8n.js`, регистрация в `backend/index.js`.
- Frontend: `src/pages/N8NIntegration.jsx`, обновление маршрутов в `src/App.jsx`, навигация `src/components/Sidebar.jsx`, базовые классы кнопок `src/index.css`.
- Документ: текущий файл `docs/n8n-integration.md`.
